---
// 播客/文章卡片组件
import ResponsiveImage from './ResponsiveImage.astro';

// 1. 先定义Props类型（明确类型约束）
interface Props {
    title: string;
    description: string;
    image: string;
    slug: string;
    type: string;
    width?: number;
    height?: number;
}

// 2. 直接解构Props并设置默认值（确保所有属性都有值）
const { 
    title, 
    description, 
    image, 
    slug, 
    type, 
    width = 600, 
    height = 400 
} = Astro.props as Props; // 强制类型断言，避免类型推断问题

// 3. 提前计算所有依赖值（确保无遗漏）
const basePath = type === '播客' ? 'podcasts' : 'articles';
const cleanSlug = slug.replace(new RegExp(`^${basePath}/`), '');

// 4. 显式声明并立即赋值cardLink（放在最前面，确保模板使用前已定义）
const cardLink: string = `/${basePath}/${cleanSlug}`.replace(/\/+/g, '/');
---

<!-- 模板中使用cardLink -->
<a href={cardLink} class="block bg-white rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 hover:scale-105">
    <div class="relative h-48 overflow-hidden">
        <ResponsiveImage
            src={image}
            alt={title}
            width={width}
            height={height}
            loading="lazy"
            decoding="async"
        />
    </div>
    <div class="p-6">
        <h3 class="text-xl font-bold mb-3 text-gray-800 hover:text-blue-600 transition-colors duration-300">{title}</h3>
        <p class="text-gray-600 line-clamp-3">{description}</p>
    </div>
</a>