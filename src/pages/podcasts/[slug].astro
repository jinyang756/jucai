---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { fetchPodcasts, fetchPodcastBySlug } from '../../lib/wordpress';

// 定义Podcast接口
interface Podcast {
  slug: string;
  title: { rendered: string };
  date: string;
  content: { rendered: string };
  meta: { audio_url: string };
}

// 生成静态路径
export async function getStaticPaths() {
  const podcasts = await fetchPodcasts();
  if (!podcasts.length) {
    return [];
  }
  return podcasts.map((podcast: Podcast) => ({
    params: { slug: podcast.slug },
    props: { podcast },
  }));
}

// 获取当前播客数据
const { podcast } = Astro.props;
if (!podcast) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={podcast.title.rendered}>
  <article class="max-w-3xl mx-auto p-6">
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{podcast.title.rendered}</h1>
      <time class="text-gray-500">{new Date(podcast.date).toLocaleDateString()}</time>
    </header>

    <div class="prose max-w-none" set:html={podcast.content.rendered} />

    <!-- 播客音频播放器 -->
    <div class="mt-8 p-4 bg-gray-100 rounded-lg">
      <h3 class="text-xl font-semibold mb-2">收听播客</h3>
      <audio controls class="w-full">
        <source src={podcast.meta.audio_url} type="audio/mpeg" />
        您的浏览器不支持音频播放
      </audio>
    </div>
  </article>
</BaseLayout>
    